

#define PIN            5  // Define the pin to which your NeoPixel strip is connected
#define NUMPIXELS      8 // Number of NeoPixels in the strip
#define FLASH_COUNT    5  // Number of times to flash
#define FLASH_DELAY    20 // Delay between each set of five flashes in milliseconds

#define DEFAULT_FRAME_TIME 42 // 42 is close to 24fps
#define FIRST_FRAME 0b10000000
#define STOP_FLAG 0b01000000
#define LOOP_FLAG 0b00100000
#define NO_FLAGS 0b00000000



const PixelFrame policeLights[20] = {
  { { {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },

  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0}, {0, 0, 255, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, LOOP_FLAG },
};


const PixelFrame redStreak[8] = {
  { { {255, 0, 0, 255}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {255, 0, 0, 0}, {0, 0, 0, 0} }, DEFAULT_FRAME_TIME, 0 },
  { { {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {255, 0, 0, 0} }, DEFAULT_FRAME_TIME, STOP_FLAG },
};

#define red_streak_timing 30
const PixelFrame redStreakWithTail[11] = {
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 320, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {255,   0,   0,   0} }, red_streak_timing, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {255,   0,   0,   0}, {128,   0,   0,   0} }, red_streak_timing, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {255,   0,   0,   0}, {128,   0,   0,   0}, { 64,   0,   0,   0} }, red_streak_timing, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {255,   0,   0,   0}, {128,   0,   0,   0}, { 64,   0,   0,   0}, {  0,   0,   0,   0} }, red_streak_timing, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {255,   0,   0,   0}, {128,   0,   0,   0}, { 64,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, red_streak_timing, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {255,   0,   0,   0}, {128,   0,   0,   0}, { 64,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, red_streak_timing, 0 },
  { { {  0,   0,   0,   0}, {255,   0,   0,   0}, {128,   0,   0,   0}, { 64,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, red_streak_timing, 0 },
  { { {255,   0,   0,   0}, {128,   0,   0,   0}, { 64,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, red_streak_timing, 0 },
  { { {128,   0,   0,   0}, { 64,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, red_streak_timing, 0 },
  { { { 64,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, red_streak_timing, STOP_FLAG },
};

const PixelFrame whiteStrobe[2] = {
  { { {255, 255, 255, 255}, {255, 255, 255, 255}, {255, 255, 255, 255}, {255, 255, 255, 255}, {255, 255, 255, 255}, {255, 255, 255, 255}, {255, 255, 255, 255}, {255, 255, 255, 255} }, 100, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 100, LOOP_FLAG }
};

const PixelFrame blueNightRider[37] = {
  { { {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0, 255,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, DEFAULT_FRAME_TIME, LOOP_FLAG },
  
};


const PixelFrame glitchFlash[24] = {
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 2000, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 750, 0 },

  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 250, 0 },

  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0, 255}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0,   0}, {  0,   0,   0, 255} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 50, 0 },

  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,  20}, {  0,   0,   0,   0}, {  0,   0,   0, 128} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,  69}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 20, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 500, 0 },

  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 255}, {  0,   0, 255,   0}, {  0,   0,   0, 255} }, 42, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 250, 0 },

  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0, 128,  60}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 42, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,  10,   0}, {  0,   0,   0, 200} }, 42, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 100}, {  0,   0,   0,   0} }, 42, 0 },
  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0, 100}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 42, 0 },

  { { {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0}, {  0,   0,   0,   0} }, 1000, STOP_FLAG },
};


const PixelFrame* _currentSequence;
int _frameIndex = 0;
bool _scriptRunning = false;

uint8_t _pixelBuffer[8][4];

elapsedMillis _frameTimer;

Adafruit_NeoPixel strip = Adafruit_NeoPixel(NUMPIXELS, PIN, NEO_GRBW + NEO_KHZ800);

void pixelSetup() {
  strip.begin();
}


void pixelLoop() {

  if(!_scriptRunning) {
    return;
  }

  if (_frameTimer >= _currentSequence[_frameIndex].holdTime && _scriptRunning) {
    advanceFrame();
  }

}


void triggerPoliceLights() {
  startPixelSequencer(policeLights);
}


void triggerRedStreak() {
  startPixelSequencer(redStreakWithTail);
}


void triggerBlueNightRider() {
  startPixelSequencer(blueNightRider);
}


void triggerGlitchFlash() {
  startPixelSequencer(glitchFlash);
}


void advanceFrame() {

  if (_currentSequence[_frameIndex].controlBits & LOOP_FLAG) {
    _frameIndex = 0;
    setStrip(_currentSequence[_frameIndex]);
  }
  else if (_currentSequence[_frameIndex].controlBits & STOP_FLAG) {
    stopPixelSequencer();
  }
  else {
    _frameIndex++;
    setStrip(_currentSequence[_frameIndex]);
  }

  _frameTimer = 0;
}


void startPixelSequencer(const PixelFrame* newSequence) {

  if (_currentSequence != newSequence || _currentSequence == NULL) {
    _currentSequence = newSequence;
  }

  _frameTimer = 0;
  _frameIndex = 0;
  setStrip (_currentSequence[_frameIndex]);
  _scriptRunning = true;
}


void stopPixelSequencer() {
  _frameIndex = 0;
  strip.clear();
  strip.show();
  _scriptRunning = false;
}


void setStrip(PixelFrame frame) {
  uint8_t r;
  uint8_t g;
  uint8_t b;
  uint8_t w;

  for (int i = 0; i < NUMPIXELS; i++) {
    r = frame.pixelData[i][0];
    g = frame.pixelData[i][1];
    b = frame.pixelData[i][2];
    w = frame.pixelData[i][3];

      strip.setPixelColor(i, strip.Color(r, g, b, w));  // Set color to red (adjust as needed)
  }
  strip.show();
}

void setPixelVUMeter(uint8_t level) {
  clearPixels();
  for (int i = 0; i < NUMPIXELS; i++) {
    if (i < level) {
      strip.setPixelColor(NUMPIXELS-1-i, strip.Color(255, 0, 0, 0));  // Set color to red (adjust as needed)
    }
    else {
      break;
    }
  }
  strip.show();
}

void clearPixels() {
  for (int i = 0; i < NUMPIXELS; i++) {
    strip.setPixelColor(i, strip.Color(0, 0, 0, 0));  // Set color to red (adjust as needed)
  }
  strip.show();
}


bool isPixelSequenceRunning() {
  return _scriptRunning;

}